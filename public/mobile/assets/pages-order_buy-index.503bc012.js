import{d as e,W as a,c as t,y as s,$ as l,z as d,A as r,o as u,b as o,w as i,f as n,e as c,g as m,t as _,h as p,ad as f,n as v,j as g,r as x,a as y,i as b,a5 as $}from"./index.5b37717f.js";import{_ as h}from"./u-icon.14dc2ec9.js";import{_ as j}from"./u-image.8c26ebe0.js";import{_ as w}from"./u-input.81163783.js";import{f as k}from"./order.35b8ae26.js";import{P as S}from"./index.73a8a495.js";import{_ as z}from"./plugin-vue_export-helper.21dcd24c.js";var C=z(e({__name:"index",setup(e){const z=a({address:[],goods:[],order_amount:"",total_amount:"",total_goods_price:""}),C=a({year:"",date:"",start_time:"",end_time:""}),T=a(""),V=a(""),D=a({goods_num:"",id:""}),E=t((()=>C.value.date?`${C.value.date} ${C.value.start_time}-${C.value.end_time}`:"请选择时间")),F=async(e="")=>{var a;const t={action:"settlement",appoint_time_start:`${C.value.year}-${C.value.date} ${C.value.start_time}`,appoint_time_end:`${C.value.year}-${C.value.date} ${C.value.end_time}`,goods:D.value,address_id:e};z.value=await k({...t}),V.value=null==(a=z.value.address)?void 0:a.id},J=async()=>{(await f({title:"温馨提示",content:"是否确认下单？"})).confirm&&M()},M=async()=>{if(!V.value)return uni.$u.toast("请先去选择地址");const e={action:"submit",appoint_time_start:`${C.value.year}-${C.value.date} ${C.value.start_time}`,appoint_time_end:`${C.value.year}-${C.value.date} ${C.value.end_time}`,goods:D.value,address_id:V.value,user_remark:T.value};try{const a=await k({...e});console.log("res",a),v({url:`/bundle/pages/order_pay/order_pay?order_id=${a.order_id}&from=${a.type}`})}catch(a){console.log("下单",a)}},N=e=>{v({url:e})};return s((e=>{const{goodsData:a,appointData:t}=JSON.parse(e.params);D.value=a,C.value=t,F(),l("appointTime",(e=>{C.value=e})),l("address",(e=>{V.value=e,F(e)}))})),d((()=>{r(["appointTime","address"])})),(e,a)=>{const t=g,s=x(y("u-icon"),h),l=x(y("u-image"),j),d=b,r=x(y("u-input"),w),f=$;return u(),o(t,{class:"order_buy"},{default:i((()=>[n(" Main Start "),n(" 地址卡片 "),c(t,{class:"card",onClick:a[0]||(a[0]=e=>N("/bundle/pages/user_address/index?type=true"))},{default:i((()=>[c(t,{class:"card--header flex justify-between"},{default:i((()=>[0===z.value.address.length?(u(),o(t,{key:0,class:"title pt-[20rpx]"},{default:i((()=>[m("请选择地址")])),_:1})):(u(),o(t,{key:1,class:"title"},{default:i((()=>{var e,a;return[m(_(null==(e=z.value.address)?void 0:e.contact)+" "+_(null==(a=z.value.address)?void 0:a.mobile),1)]})),_:1})),c(s,{name:"arrow-right",color:"#707070",size:"22"})])),_:1}),z.value.address.length?n("v-if",!0):(u(),o(t,{key:0,class:"text-sm text-muted"},{default:i((()=>[m(_(z.value.address.province)+" "+_(z.value.address.city)+" "+_(z.value.address.district)+" "+_(z.value.address.address),1)])),_:1}))])),_:1}),n(" 商品卡片 "),c(t,{class:"card"},{default:i((()=>[c(t,{class:"goods-item"},{default:i((()=>[c(l,{src:z.value.goods.image,width:"160",height:"160","border-radius":"4"},null,8,["src"]),c(t,{class:"ml-[20rpx] mt-[4rpx]"},{default:i((()=>[c(t,{class:"flex justify-between title"},{default:i((()=>[c(t,{class:"goods-item--name truncate"},{default:i((()=>[m(_(z.value.goods.name),1)])),_:1}),c(d,{class:"num"},{default:i((()=>[m("x"+_(z.value.goods.goods_num),1)])),_:1})])),_:1}),c(t,{class:"mt-[24rpx]"},{default:i((()=>[c(S,{price:z.value.goods.price,desc:z.value.goods.unit_desc},null,8,["price","desc"])])),_:1})])),_:1})])),_:1})])),_:1}),n(" 上门时间 "),c(t,{class:"card flex justify-between",onClick:a[1]||(a[1]=e=>N(`/bundle/pages/appoint_time/index?appointTime=${JSON.stringify(C.value)}`))},{default:i((()=>[c(t,{class:"normal text-base font-medium"},{default:i((()=>[m("上门时间")])),_:1}),c(t,{class:"flex"},{default:i((()=>[c(d,{class:"mr-[20rpx] text-sm text-black"},{default:i((()=>[m(_(p(E)),1)])),_:1}),c(s,{name:"arrow-right",color:"#707070",size:"22"})])),_:1})])),_:1}),n(" 备注 "),c(t,{class:"card"},{default:i((()=>[c(t,{class:"normal text-lg font-medium"},{default:i((()=>[m("备注")])),_:1}),c(t,{class:"mt-[10rpx]"},{default:i((()=>[c(r,{modelValue:T.value,"onUpdate:modelValue":a[2]||(a[2]=e=>T.value=e),type:"textarea",placeholder:"请填写您的特殊需求",height:"124"},null,8,["modelValue"])])),_:1})])),_:1}),n(" 服务金额 "),c(t,{class:"card flex justify-between normal text-base"},{default:i((()=>[c(t,{class:"font-medium"},{default:i((()=>[m("服务金额")])),_:1}),c(t,null,{default:i((()=>[m(_(`¥${z.value.total_goods_price}`),1)])),_:1})])),_:1}),n(" Main End "),n(" Footer Start "),c(t,{class:"footer flex justify-between items-center"},{default:i((()=>[c(t,{class:"text-primary"},{default:i((()=>[c(d,{class:"text-base"},{default:i((()=>[m("需支付：¥")])),_:1}),c(d,{class:"font-medium text-4xl"},{default:i((()=>[m(_(z.value.order_amount),1)])),_:1})])),_:1}),c(t,{class:"btn"},{default:i((()=>[c(f,{class:"bg-primary text-lg text-white leading-[80rpx] h-[80rpx]",onClick:J},{default:i((()=>[m(" 提交订单 ")])),_:1})])),_:1})])),_:1}),n(" Footer End ")])),_:1})}}}),[["__scopeId","data-v-6c26413e"]]);export{C as default};
